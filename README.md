*****************************| System Information |*****************************

Dependency Walker:       2.2.6000 (64-bit)
Operating System:        Microsoft Windows NT/2000/XP/2003/Vista based Professional (64-bit)
OS Version:              6.02.9200
Processor:               Intel64 Family 6 Model 151 Stepping 2, GenuineIntel, ~2112MHz
Number of Processors:    20, Mask: 0x00000000000FFFFF
Computer Name:           DESKTOP-CNC9HGR
User Name:               y30070713
Local Date:              2025年1月21日
Local Time:              9:31:28  (GMT+08:00)
OS Language:             0x0804: Chinese (PRC)
Memory Load:             41%
Physical Memory Total:   34,049,679,360 (32473 MB)
Physical Memory Used:    14,166,077,440
Physical Memory Free:    19,883,601,920
Page File Memory Total:  44,974,395,392
Page File Memory Used:   17,810,927,616
Page File Memory Free:   27,163,467,776
Virtual Memory Total:    140,737,488,224,256
Virtual Memory Used:     4,647,104,512
Virtual Memory Free:     140,732,841,119,744
Page Size:               0x00001000 (4,096)
Allocation Granularity:  0x00010000 (65,536)
Min. App. Address:       0x0000000000010000 (65,536)
Max. App. Address:       0x00007FFFFFFEFFFF (140,737,488,289,791)

********************************| Search Order |********************************
*                                                                              *
* Legend: F  File                     E  Error (path not valid)                *
*                                                                              *
********************************************************************************

Side-by-Side components (Windows 2000/XP/2003/Vista/+)
   [F ] c:\windows\winsxs\amd64_microsoft.windows.common-controls_6595b64144ccf1df_6.0.22621.2070_none_2713e6537381f706\COMCTL32.DLL
   [F ] c:\windows\winsxs\amd64_microsoft.windows.gdiplus_6595b64144ccf1df_1.1.22621.1778_none_57fe2016ce1542ec\GDIPLUS.DLL
The system's "KnownDLLs" list
   [F ] c:\windows\system32\ADVAPI32.DLL
   [F ] c:\windows\system32\BCRYPTPRIMITIVES.DLL
   [F ] c:\windows\system32\CLBCATQ.DLL
   [F ] c:\windows\system32\COMBASE.DLL
   [F ] c:\windows\system32\COMCTL32.DLL
   [F ] c:\windows\system32\COMDLG32.DLL
   [F ] c:\windows\system32\COML2.DLL
   [F ] c:\windows\system32\CRYPT32.DLL
   [F ] c:\windows\system32\DIFXAPI.DLL
   [F ] c:\windows\system32\GDI32.DLL
   [F ] c:\windows\system32\GDI32FULL.DLL
   [F ] c:\windows\system32\GDIPLUS.DLL
   [F ] c:\windows\system32\IMAGEHLP.DLL
   [F ] c:\windows\system32\IMM32.DLL
   [F ] c:\windows\system32\KERNEL32.DLL
   [F ] c:\windows\system32\KERNELBASE.DLL
   [F ] c:\windows\system32\MSCTF.DLL
   [F ] c:\windows\system32\MSVCP_WIN.DLL
   [F ] c:\windows\system32\MSVCRT.DLL
   [F ] c:\windows\system32\NORMALIZ.DLL
   [F ] c:\windows\system32\NSI.DLL
   [F ] c:\windows\system32\NTDLL.DLL
   [F ] c:\windows\system32\NTDLL.DLL
   [F ] c:\windows\system32\OLE32.DLL
   [F ] c:\windows\system32\OLEAUT32.DLL
   [F ] c:\windows\system32\PSAPI.DLL
   [F ] c:\windows\system32\RPCRT4.DLL
   [F ] c:\windows\system32\SECHOST.DLL
   [F ] c:\windows\system32\SETUPAPI.DLL
   [F ] c:\windows\system32\SHCORE.DLL
   [F ] c:\windows\system32\SHELL32.DLL
   [F ] c:\windows\system32\SHLWAPI.DLL
   [F ] c:\windows\system32\UCRTBASE.DLL
   [F ] c:\windows\system32\USER32.DLL
   [F ] c:\windows\system32\WIN32U.DLL
   [F ] c:\windows\system32\WINTRUST.DLL
   [F ] c:\windows\system32\WLDAP32.DLL
   [F ] c:\windows\system32\WOW64.DLL
   [F ] c:\windows\system32\WOW64BASE.DLL
   [F ] c:\windows\system32\WOW64CON.DLL
   [F ] c:\windows\system32\WOW64CPU.DLL
   [F ] c:\windows\system32\WOW64WIN.DLL
   [F ] c:\windows\system32\WS2_32.DLL
The application directory
   [  ] D:\HW CloudLink\
The 32-bit system directory
   [  ] C:\Windows\system32\
The 16-bit system directory (Windows NT/2000/XP/2003/Vista/+)
   [  ] C:\Windows\system\
The system's root OS directory
   [  ] C:\Windows\
The application's registered "App Paths" directories
The system's "PATH" environment variable directories
   [  ] C:\Program Files\Huawei\jdk1.8.0_272\bin\
   [  ] C:\Windows\
   [  ] C:\Windows\system32\
   [  ] C:\Windows\System32\Wbem\
   [  ] C:\Windows\System32\WindowsPowerShell\v1.0\
   [  ] C:\Windows\
   [  ] C:\Windows\system32\
   [  ] C:\Windows\System32\Wbem\
   [  ] C:\Windows\System32\WindowsPowerShell\v1.0\
   [  ] C:\Windows\System32\WindowsPowerShell\v1.0\
   [  ] D:\adb\adb\
   [  ] D:\Python27\Scripts\
   [  ] D:\Python27\
   [  ] C:\Users\y30070713\AppData\Local\Programs\Python\Python38\Scripts\
   [  ] C:\Users\y30070713\AppData\Local\Programs\Python\Python38\
   [  ] C:\Users\y30070713\AppData\Local\Microsoft\WindowsApps\
   [  ] D:\PyCharm\PyCharm 2023.2.5\bin\
   [  ] D:\TOOLs\nmap\Nmap\

***************************| Module Dependency Tree |***************************
*                                                                              *
* Legend: F  Forwarded Module   ?  Missing Module        6  64-bit Module      *
*         D  Delay Load Module  !  Invalid Module                              *
*         *  Dynamic Module     E  Import/Export Mismatch or Load Failure      *
*                               ^  Duplicate Module                            *
*                                                                              *
*         O  Ordinal Function   E  Import/Export Error   F  Forwarded Function *
*         C  C Function         R  Called At Least Once  *  Dynamic Function   *
*         +  C++ Function                                                      *
*                                                                              *
********************************************************************************

[   ] HW CLOUDLINK.EXE

     Import  Ordinal  Hint  Function  Entry Point
     ------  -------  ----  --------  -----------

     Export  Ordinal  Hint  Function  Entry Point
     ------  -------  ----  --------  -----------

     [ E6] MSVCRT.DLL

          Import  Ordinal        Hint           Function                                                              Entry Point
          ------  -------------  -------------  --------------------------------------------------------------------  -----------
          [C  ]             N/A   489 (0x01E9)  _wcsdup                                                               Not Bound
          [C  ]             N/A   490 (0x01EA)  _wcsicmp                                                              Not Bound
          [C  ]             N/A   494 (0x01EE)  _wcsnicmp                                                             Not Bound
          [C  ]             N/A   606 (0x025E)  free                                                                  Not Bound
          [C  ]             N/A   657 (0x0291)  malloc                                                                Not Bound
          [C  ]             N/A   663 (0x0297)  memcpy                                                                Not Bound
          [C  ]             N/A   664 (0x0298)  memmove                                                               Not Bound
          [C  ]             N/A   665 (0x0299)  memset                                                                Not Bound
          [C  ]             N/A   723 (0x02D3)  tolower                                                               Not Bound
          [C  ]             N/A   735 (0x02DF)  wcscat                                                                Not Bound
          [C  ]             N/A   737 (0x02E1)  wcscmp                                                                Not Bound
          [C  ]             N/A   739 (0x02E3)  wcscpy                                                                Not Bound
          [C  ]             N/A   742 (0x02E6)  wcslen                                                                Not Bound
          [C  ]             N/A   744 (0x02E8)  wcsncmp                                                               Not Bound
          [C  ]             N/A   745 (0x02E9)  wcsncpy                                                               Not Bound
          [C  ]             N/A   749 (0x02ED)  wcsstr                                                                Not Bound

          Export  Ordinal        Hint           Function                                                              Entry Point
          ------  -------------  -------------  --------------------------------------------------------------------  -----------
          [+  ]      1 (0x0001)     0 (0x0000)  ??0__non_rtti_object@@QEAA@AEBV0@@Z                                   0x0000A850


          [ E6] NTDLL.DLL

               Import  Ordinal        Hint           Function                                               Entry Point
               ------  -------------  -------------  -----------------------------------------------------  -----------
               [C  ]             N/A   773 (0x0305)  RtlCaptureContext                                      Not Bound
               [C  ]             N/A  1289 (0x0509)  RtlLookupFunctionEntry                                 Not Bound
               [C  ]             N/A  1330 (0x0532)  RtlPcToFileHeader                                      Not Bound
               [C  ]             N/A  1587 (0x0633)  RtlUnwind                                              Not Bound
               [C  ]             N/A  1588 (0x0634)  RtlUnwindEx                                            Not Bound
               [C  ]             N/A  1614 (0x064E)  RtlVirtualUnwind                                       Not Bound

               Export  Ordinal        Hint           Function                                               Entry Point
               ------  -------------  -------------  -----------------------------------------------------  -----------
               [OR ]      8 (0x0008)            N/A  N/A                                                    0x0007F660
               [CR ]      9 (0x0009)     0 (0x0000)  A_SHAFinal                                             0x0000E6E0
               [CR ]     10 (0x000A)     1 (0x0001)  A_SHAInit                                              0x0000E810
               [CR ]     11 (0x000B)     2 (0x0002)  A_SHAUpdate                                            0x0000E850
               [C  ]     12 (0x000C)     3 (0x0003)  AlpcAdjustCompletionListConcurrencyCount               0x000EAFF0
               [CR ]     13 (0x000D)     4 (0x0004)  AlpcFreeCompletionListMessage                          0x0007E290
               [C  ]     14 (0x000E)     5 (0x0005)  AlpcGetCompletionListLastMessageInformation            0x000EB020
               [FE6] KERNEL32.DLL

                    Import  Ordinal  Hint  Function                       Entry Point
                    ------  -------  ----  -----------------------------  -----------
                    [C  ]       N/A   N/A  GetConsoleCP                   Not Bound
                    [C  ]       N/A   N/A  GetNumberOfConsoleInputEvents  Not Bound
                    [C  ]       N/A   N/A  WriteConsoleW                  Not Bound
                    [C  ]       N/A   N/A  ReadConsoleW                   Not Bound
                    [C  ]       N/A   N/A  SetConsoleMode                 Not Bound
                    [C  ]       N/A   N/A  GetConsoleMode                 Not Bound
                    [C  ]       N/A   N/A  SetConsoleCtrlHandler          Not Bound
                    [C  ]       N/A   N/A  ReadConsoleInputW              Not Bound
                    [C  ]       N/A   N/A  ReadConsoleInputA              Not Bound

          [ ? ] API-MS-WIN-CORE-CONSOLE-L1-2-0.DLL

               Import  Ordinal  Hint        Function           Entry Point
               ------  -------  ----------  -----------------  -----------
               [CE ]       N/A  9 (0x0009)  PeekConsoleInputA  Not Bound

               Export  Ordinal  Hint        Function           Entry Point
               ------  -------  ----------  -----------------  -----------

          [ E6] API-MS-WIN-CORE-DATETIME-L1-1-0.DLL

               Import  Ordinal     Hint        Function        Entry Point
               ------  ----------  ----------  --------------  -----------------------
               [C  ]          N/A  0 (0x0000)  GetDateFormatA  Not Bound
               [C  ]          N/A  2 (0x0002)  GetDateFormatW  Not Bound
               [C  ]          N/A  4 (0x0004)  GetTimeFormatA  Not Bound
               [C  ]          N/A  6 (0x0006)  GetTimeFormatW  Not Bound

               Export  Ordinal     Hint        Function        Entry Point
               ------  ----------  ----------  --------------  -----------------------
               [CRF]   1 (0x0001)  0 (0x0000)  GetDateFormatA  kernel32.GetDateFormatA
               [CRF]   2 (0x0002)  1 (0x0001)  GetDateFormatW  kernel32.GetDateFormatW
               [CRF]   3 (0x0003)  2 (0x0002)  GetTimeFormatA  kernel32.GetTimeFormatA
               [CRF]   4 (0x0004)  3 (0x0003)  GetTimeFormatW  kernel32.GetTimeFormatW

# -*- coding: utf-8 -*-

import argparse
import re
import codecs

def process_depends_txt(input_file, output_file):
    dll_info = {}
    current_dll = None
    import_functions = []
    export_functions = []
    is_export_section = False
    is_import_section = False

    # 读取depends的输出文件
    with codecs.open(input_file, 'r', encoding='utf-8') as infile:
        lines = infile.readlines()

    # 解析每一行
    for line in lines:
        line = line.strip()

        if line.startswith('*****') or line.startswith("Side-by-Side") or line.startswith("The System's"):
            continue
        # checkdll
        dll_match = re.match(r"^\[\s*.*\]\s+([\w\-.]+)\.DLL", line, re.IGNORECASE)
        if dll_match:
            if current_dll:
                # 保存前一个dll数据
                dll_info[current_dll] = {
                    'imports': import_functions,
                    'exports': export_functions,
                }

            current_dll = dll_match.group(1)
            import_functions = []
            export_functions = []
            is_export_section = False
            is_import_section = False
            continue

        if "Import" in line and "Function" in line:
            is_import_section = True
            is_export_section = False
            continue

        if "Export" in line and "Function" in line:
            is_import_section = False
            is_export_section = True
            continue

        if re.match(r"^-+$", line):
            continue

        if is_import_section or is_export_section:
            columns = line.split()
            if len(columns) >=4:
                function_name = columns[-3]
                if function_name not in ["N/A","-----------------------------"]:
                    if is_import_section:
                        import_functions.append(function_name)
                    elif is_export_section:
                        export_functions.append(function_name)


    if current_dll:
        dll_info[current_dll] = {
            'imports': import_functions,
            'exports': export_functions,
        }

    with codecs.open(output_file, 'w', encoding="utf-8") as outfile:
        for dll, functions in dll_info.items():
            exports = functions['exports']
            imports = functions['imports']

            if not exports:
                continue

            for imp_func in imports:
                if imp_func not in exports:
                    outfile.write("{} -> {}\n".format(dll, imp_func))


def main():
    parser = argparse.ArgumentParser(description="Process Dependency Walker output and find missing exported functions.")
    parser.add_argument("input_file", help="Path to the Dependency Walker output text file.")
    parser.add_argument("output_file", help="Path to the output text file.")

    args = parser.parse_args()

    process_depends_txt(args.input_file, args.output_file)
    print("Finish:{}".format(args.output_file))


# 按装订区域中的绿色按钮以运行脚本。
if __name__ == '__main__':
    main()

API-MS-WIN-CORE-CONSOLE-L1-2-0 -> PeekConsoleInputA
NTDLL -> RtlCaptureContext
NTDLL -> RtlLookupFunctionEntry
NTDLL -> RtlPcToFileHeader
NTDLL -> RtlUnwind
NTDLL -> RtlUnwindEx
NTDLL -> RtlVirtualUnwind
API-MS-WIN-CORE-DATETIME-L1-1-0 -> GetDateFormatA
API-MS-WIN-CORE-DATETIME-L1-1-0 -> GetDateFormatW
API-MS-WIN-CORE-DATETIME-L1-1-0 -> GetTimeFormatA
API-MS-WIN-CORE-DATETIME-L1-1-0 -> GetTimeFormatW
MSVCRT -> _wcsdup
MSVCRT -> _wcsicmp
MSVCRT -> _wcsnicmp
MSVCRT -> free
MSVCRT -> malloc
MSVCRT -> memcpy
MSVCRT -> memmove
MSVCRT -> memset
MSVCRT -> tolower
MSVCRT -> wcscat
MSVCRT -> wcscmp
MSVCRT -> wcscpy
MSVCRT -> wcslen
MSVCRT -> wcsncmp
MSVCRT -> wcsncpy
MSVCRT -> wcsstr


               
